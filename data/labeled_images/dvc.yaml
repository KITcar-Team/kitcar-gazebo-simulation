stages:
  create_labeled_train_images:
    cmd: python3 -m simulation.utils.machine_learning.data.extract_simulated_images --road ci_roads/random_road
      --seed kitcar1 kitcar2 kitcar3 kitcar4 kitcar5 kitcar6 kitcar7 kitcar8 kitcar9 kitcar10
      kitcar11 kitcar12 kitcar13 kitcar14 kitcar15 kitcar16 kitcar17 kitcar18 kitcar19 kitcar20
      --output_dir random_roads --image_topic /camera/image_raw --label_camera --control_sim_rate
      --label_image_topic /simulation/label_camera/image --label_topic /simulation/label_camera/image_labels
      --label_file random_roads/labels.yaml && fdupes -dN random_roads/ && fdupes -dN random_roads/debug # Remove duplicates
    deps:
    - ../../simulation/models/env_db/ci_roads/random_road.py
    - ../../simulation/models/meshes
    outs:
    - random_roads

  apply_cycle_gan_to_random_roads_labeled:
    cmd: python3 -m simulation.utils.machine_learning.cycle_gan.image_translator --input_dir random_roads/
      --output_dir gan_random_roads && cp random_roads/labels.yaml gan_random_roads
    deps:
    - random_roads
    - ../../simulation/utils/machine_learning/cycle_gan/image_translator.py
    - ../../simulation/utils/machine_learning/cycle_gan/checkpoints/dr_drift/latest_net_g_a_to_b.pth
    - ../../simulation/utils/machine_learning/cycle_gan/checkpoints/dr_drift/latest_net_g_b_to_a.pth
    outs:
    - gan_random_roads
